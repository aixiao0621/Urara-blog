import{S as fo,i as io,s as _o,U as Pl,y as no,z as uo,A as Eo,V as po,W as ao,g as ho,d as vo,B as Po,X as co,k as a,q as l,a as i,l as d,m as c,r as o,h as t,c as _,n as p,b as E,D as e,E as mo}from"../chunks/index.cb04554d.js";import{P as Ao}from"../chunks/post_layout.d05b1760.js";function Co(R){let f,C,P,H,u,v,L,Ze,ye,x,Re,re,Ve,We,$,Xe,Ge,$e,S,V,Ne,qe,W,ae,Ye,Te,n,k,ge,q,et,tt,de,lt,ot,rt,j,at,ce,dt,ct,st,z,ft,T,it,_t,nt,se,ut,Et,F,pt,fe,ht,vt,Pt,J,mt,ie,At,Ct,xt,A,Ot,_e,Dt,Lt,ne,kt,bt,ue,It,wt,yt,Ee,$t,qt,b,Tt,pe,Ut,Bt,he,Ht,St,Ue,K,X,jt,Be,U,ve,zt,Ft,M,Jt,Pe,Kt,Mt,He,G,I,Qt,me,Zt,Rt,Ae,Vt,Wt,Se,Q,N,Xt,je,m,Ce,Gt,Nt,O,Yt,xe,gt,el,Oe,tl,ll,De,ol,rl,w,al,Le,dl,cl,ke,sl,fl,il,y,_l,be,nl,ul,Ie,El,pl,hl,we,vl;return{c(){f=a("p"),C=l("官方 APP 使用不便 于是想开发一个使用更便捷的第三方 APP "),P=a("a"),H=l("项目地址"),u=i(),v=a("h2"),L=a("a"),Ze=l("APP 逆向"),ye=i(),x=a("p"),Re=l("抓包 发现 "),re=a("code"),Ve=l("data"),We=l(` 有加密 尝试解密失败，试图寻找源码
使用工具`),$=a("a"),Xe=l("frida-dexdump"),Ge=l(" 脱壳，但得到的代码可读性很低，发现有小程序，于是转战"),$e=i(),S=a("h2"),V=a("a"),Ne=l("微信小程序 逆向"),qe=i(),W=a("blockquote"),ae=a("p"),Ye=l("原以为小程序和微信服务器的沟通只是为了拿到手机号明文，于是想要直接使用小程序的请求方式完成登录等全部流程"),Te=i(),n=a("ul"),k=a("li"),ge=l("使用工具 "),q=a("a"),et=l("unveilr"),tt=l(" 直接对"),de=a("code"),lt=l("__APP__.wxapkg"),ot=l("进行解包"),rt=i(),j=a("li"),at=l("使用"),ce=a("code"),dt=l("微信开发者工具"),ct=l("打开解包后的文件并尝试编译，成功 (好运)"),st=i(),z=a("li"),ft=l("尝试使用 Burpsuite 和 proxifier 对 PC 端小程序抓包，参考了"),T=a("a"),it=l("相关教程"),_t=l(",寻找登录请求，发现和 APP 抓到的包有相同的加密"),nt=i(),se=a("li"),ut=l("由于解包后的小程序代码有混淆，可读性差，于是直接调试"),Et=i(),F=a("li"),pt=l("小程序的主要 JS 代码位于根目录下，由于其中的函数均声明了 "),fe=a("code"),ht=l('"use strict"'),vt=l(" 所以先删除"),Pt=i(),J=a("li"),mt=l("搜索加密函数 直接使用"),ie=a("code"),At=l("console.log"),Ct=l("打印，在调试器里导出为全局变量 就可以进行加解密操作了"),xt=i(),A=a("li"),Ot=l("在某些情况下，会提示字符串不是 UTF-8，这时候需要将 "),_e=a("code"),Dt=l("\\\\/"),Lt=l(" 改为 "),ne=a("code"),kt=l("\\/"),bt=l(" 可能还需要增减 "),ue=a("code"),It=l("="),wt=l(" 的数量"),yt=i(),Ee=a("li"),$t=l("到这里以为已经结束了，抓到的包可以直接解出，但是解密小程序的登录请求后发现里面还有一层加密且无法使用同样的解密方式解密"),qt=i(),b=a("li"),Tt=l("解密的微信小程序登录请求包中存在一个名为"),pe=a("code"),Ut=l("code"),Bt=l("的 key 通过查阅微信开发者文档，判断应该是与微信服务器的交流中拿到的，奈何微信的数据包加密十分抽象，没有思路拿到 "),he=a("code"),Ht=l("code"),St=l(" 于是思路再次中断"),Ue=i(),K=a("h2"),X=a("a"),jt=l("又回到最初的起点🎵"),Be=i(),U=a("ul"),ve=a("li"),zt=l("偶然发现小程序的解密方式对 APP 抓到的包同样适用，于是柳暗花明，拿到验证码登录和打开饮水机的请求方式"),Ft=i(),M=a("li"),Jt=l("现在只需要复现加解密函数即可，找到 "),Pe=a("code"),Kt=l("crypto-js"),Mt=l(" 库，发现完全一致，仅需的两个参数：密钥和密钥偏移量，也写在小程序的源码中"),He=i(),G=a("blockquote"),I=a("p"),Qt=l("上面提到的"),me=a("code"),Zt=l("code"),Rt=l("应该是微信服务端同时发送到小程序服务端和小程序客户端，一起发送给小程序服务端的还有被加密的手机号，小程序客户端需要用"),Ae=a("code"),Vt=l("code"),Wt=l("才能拿到明文手机号"),Se=i(),Q=a("h2"),N=a("a"),Xt=l("APP 开发"),je=i(),m=a("ul"),Ce=a("li"),Gt=l("在伪造请求时要注意发送数据的编码类型"),Nt=i(),O=a("li"),Yt=l("在新版本中，如果要发送 http 请求，需要在 "),xe=a("code"),gt=l("AndroidManifest.xml"),el=l(" 的 "),Oe=a("code"),tl=l("application"),ll=l(" 中 增加 "),De=a("code"),ol=l('android:usesCleartextTraffic="true"'),rl=i(),w=a("li"),al=l("可能是由于编码方式的问题 返回的字符串有多余的 "),Le=a("code"),dl=l('\\"'),cl=l(" 和 "),ke=a("code"),sl=l("\\\\"),fl=l(" 字符"),il=i(),y=a("li"),_l=l("在 kotlin 中进行解密操作时，由于 "),be=a("code"),nl=l("\\\\/"),ul=l(" 字符的出现，需要使用三层`"),Ie=a("code"),El=l("对整体字符串进行包裹，使其转为 "),pl=l("raw` 后再进行替换操作"),hl=i(),we=a("li"),vl=l("替换字符串时，kotlin 的正则貌似不大好用"),this.h()},l(r){f=d(r,"P",{});var s=c(f);C=o(s,"官方 APP 使用不便 于是想开发一个使用更便捷的第三方 APP "),P=d(s,"A",{href:!0,rel:!0,target:!0});var ml=c(P);H=o(ml,"项目地址"),ml.forEach(t),s.forEach(t),u=_(r),v=d(r,"H2",{id:!0});var Al=c(v);L=d(Al,"A",{href:!0});var Cl=c(L);Ze=o(Cl,"APP 逆向"),Cl.forEach(t),Al.forEach(t),ye=_(r),x=d(r,"P",{});var Y=c(x);Re=o(Y,"抓包 发现 "),re=d(Y,"CODE",{});var xl=c(re);Ve=o(xl,"data"),xl.forEach(t),We=o(Y,` 有加密 尝试解密失败，试图寻找源码
使用工具`),$=d(Y,"A",{href:!0,rel:!0,target:!0});var Ol=c($);Xe=o(Ol,"frida-dexdump"),Ol.forEach(t),Ge=o(Y," 脱壳，但得到的代码可读性很低，发现有小程序，于是转战"),Y.forEach(t),$e=_(r),S=d(r,"H2",{id:!0});var Dl=c(S);V=d(Dl,"A",{href:!0});var Ll=c(V);Ne=o(Ll,"微信小程序 逆向"),Ll.forEach(t),Dl.forEach(t),qe=_(r),W=d(r,"BLOCKQUOTE",{});var kl=c(W);ae=d(kl,"P",{});var bl=c(ae);Ye=o(bl,"原以为小程序和微信服务器的沟通只是为了拿到手机号明文，于是想要直接使用小程序的请求方式完成登录等全部流程"),bl.forEach(t),kl.forEach(t),Te=_(r),n=d(r,"UL",{});var h=c(n);k=d(h,"LI",{});var g=c(k);ge=o(g,"使用工具 "),q=d(g,"A",{href:!0,rel:!0,target:!0});var Il=c(q);et=o(Il,"unveilr"),Il.forEach(t),tt=o(g," 直接对"),de=d(g,"CODE",{});var wl=c(de);lt=o(wl,"__APP__.wxapkg"),wl.forEach(t),ot=o(g,"进行解包"),g.forEach(t),rt=_(h),j=d(h,"LI",{});var ze=c(j);at=o(ze,"使用"),ce=d(ze,"CODE",{});var yl=c(ce);dt=o(yl,"微信开发者工具"),yl.forEach(t),ct=o(ze,"打开解包后的文件并尝试编译，成功 (好运)"),ze.forEach(t),st=_(h),z=d(h,"LI",{});var Fe=c(z);ft=o(Fe,"尝试使用 Burpsuite 和 proxifier 对 PC 端小程序抓包，参考了"),T=d(Fe,"A",{href:!0,rel:!0,target:!0});var $l=c(T);it=o($l,"相关教程"),$l.forEach(t),_t=o(Fe,",寻找登录请求，发现和 APP 抓到的包有相同的加密"),Fe.forEach(t),nt=_(h),se=d(h,"LI",{});var ql=c(se);ut=o(ql,"由于解包后的小程序代码有混淆，可读性差，于是直接调试"),ql.forEach(t),Et=_(h),F=d(h,"LI",{});var Je=c(F);pt=o(Je,"小程序的主要 JS 代码位于根目录下，由于其中的函数均声明了 "),fe=d(Je,"CODE",{});var Tl=c(fe);ht=o(Tl,'"use strict"'),Tl.forEach(t),vt=o(Je," 所以先删除"),Je.forEach(t),Pt=_(h),J=d(h,"LI",{});var Ke=c(J);mt=o(Ke,"搜索加密函数 直接使用"),ie=d(Ke,"CODE",{});var Ul=c(ie);At=o(Ul,"console.log"),Ul.forEach(t),Ct=o(Ke,"打印，在调试器里导出为全局变量 就可以进行加解密操作了"),Ke.forEach(t),xt=_(h),A=d(h,"LI",{});var B=c(A);Ot=o(B,"在某些情况下，会提示字符串不是 UTF-8，这时候需要将 "),_e=d(B,"CODE",{});var Bl=c(_e);Dt=o(Bl,"\\\\/"),Bl.forEach(t),Lt=o(B," 改为 "),ne=d(B,"CODE",{});var Hl=c(ne);kt=o(Hl,"\\/"),Hl.forEach(t),bt=o(B," 可能还需要增减 "),ue=d(B,"CODE",{});var Sl=c(ue);It=o(Sl,"="),Sl.forEach(t),wt=o(B," 的数量"),B.forEach(t),yt=_(h),Ee=d(h,"LI",{});var jl=c(Ee);$t=o(jl,"到这里以为已经结束了，抓到的包可以直接解出，但是解密小程序的登录请求后发现里面还有一层加密且无法使用同样的解密方式解密"),jl.forEach(t),qt=_(h),b=d(h,"LI",{});var ee=c(b);Tt=o(ee,"解密的微信小程序登录请求包中存在一个名为"),pe=d(ee,"CODE",{});var zl=c(pe);Ut=o(zl,"code"),zl.forEach(t),Bt=o(ee,"的 key 通过查阅微信开发者文档，判断应该是与微信服务器的交流中拿到的，奈何微信的数据包加密十分抽象，没有思路拿到 "),he=d(ee,"CODE",{});var Fl=c(he);Ht=o(Fl,"code"),Fl.forEach(t),St=o(ee," 于是思路再次中断"),ee.forEach(t),h.forEach(t),Ue=_(r),K=d(r,"H2",{id:!0});var Jl=c(K);X=d(Jl,"A",{href:!0});var Kl=c(X);jt=o(Kl,"又回到最初的起点🎵"),Kl.forEach(t),Jl.forEach(t),Be=_(r),U=d(r,"UL",{});var Me=c(U);ve=d(Me,"LI",{});var Ml=c(ve);zt=o(Ml,"偶然发现小程序的解密方式对 APP 抓到的包同样适用，于是柳暗花明，拿到验证码登录和打开饮水机的请求方式"),Ml.forEach(t),Ft=_(Me),M=d(Me,"LI",{});var Qe=c(M);Jt=o(Qe,"现在只需要复现加解密函数即可，找到 "),Pe=d(Qe,"CODE",{});var Ql=c(Pe);Kt=o(Ql,"crypto-js"),Ql.forEach(t),Mt=o(Qe," 库，发现完全一致，仅需的两个参数：密钥和密钥偏移量，也写在小程序的源码中"),Qe.forEach(t),Me.forEach(t),He=_(r),G=d(r,"BLOCKQUOTE",{});var Zl=c(G);I=d(Zl,"P",{});var te=c(I);Qt=o(te,"上面提到的"),me=d(te,"CODE",{});var Rl=c(me);Zt=o(Rl,"code"),Rl.forEach(t),Rt=o(te,"应该是微信服务端同时发送到小程序服务端和小程序客户端，一起发送给小程序服务端的还有被加密的手机号，小程序客户端需要用"),Ae=d(te,"CODE",{});var Vl=c(Ae);Vt=o(Vl,"code"),Vl.forEach(t),Wt=o(te,"才能拿到明文手机号"),te.forEach(t),Zl.forEach(t),Se=_(r),Q=d(r,"H2",{id:!0});var Wl=c(Q);N=d(Wl,"A",{href:!0});var Xl=c(N);Xt=o(Xl,"APP 开发"),Xl.forEach(t),Wl.forEach(t),je=_(r),m=d(r,"UL",{});var D=c(m);Ce=d(D,"LI",{});var Gl=c(Ce);Gt=o(Gl,"在伪造请求时要注意发送数据的编码类型"),Gl.forEach(t),Nt=_(D),O=d(D,"LI",{});var Z=c(O);Yt=o(Z,"在新版本中，如果要发送 http 请求，需要在 "),xe=d(Z,"CODE",{});var Nl=c(xe);gt=o(Nl,"AndroidManifest.xml"),Nl.forEach(t),el=o(Z," 的 "),Oe=d(Z,"CODE",{});var Yl=c(Oe);tl=o(Yl,"application"),Yl.forEach(t),ll=o(Z," 中 增加 "),De=d(Z,"CODE",{});var gl=c(De);ol=o(gl,'android:usesCleartextTraffic="true"'),gl.forEach(t),Z.forEach(t),rl=_(D),w=d(D,"LI",{});var le=c(w);al=o(le,"可能是由于编码方式的问题 返回的字符串有多余的 "),Le=d(le,"CODE",{});var eo=c(Le);dl=o(eo,'\\"'),eo.forEach(t),cl=o(le," 和 "),ke=d(le,"CODE",{});var to=c(ke);sl=o(to,"\\\\"),to.forEach(t),fl=o(le," 字符"),le.forEach(t),il=_(D),y=d(D,"LI",{});var oe=c(y);_l=o(oe,"在 kotlin 中进行解密操作时，由于 "),be=d(oe,"CODE",{});var lo=c(be);nl=o(lo,"\\\\/"),lo.forEach(t),ul=o(oe," 字符的出现，需要使用三层`"),Ie=d(oe,"CODE",{});var oo=c(Ie);El=o(oo,"对整体字符串进行包裹，使其转为 "),oo.forEach(t),pl=o(oe,"raw` 后再进行替换操作"),oe.forEach(t),hl=_(D),we=d(D,"LI",{});var ro=c(we);vl=o(ro,"替换字符串时，kotlin 的正则貌似不大好用"),ro.forEach(t),D.forEach(t),this.h()},h(){p(P,"href","https://github.com/aixiao0621/Duoheshui"),p(P,"rel","nofollow noopener noreferrer external"),p(P,"target","_blank"),p(L,"href","#app-逆向"),p(v,"id","app-逆向"),p($,"href","https://github.com/hluwa/frida-dexdump"),p($,"rel","nofollow noopener noreferrer external"),p($,"target","_blank"),p(V,"href","#微信小程序-逆向"),p(S,"id","微信小程序-逆向"),p(q,"href","https://github.com/r3x5ur/unveilr"),p(q,"rel","nofollow noopener noreferrer external"),p(q,"target","_blank"),p(T,"href","https://blog.csdn.net/weixin_45031612/article/details/127416319"),p(T,"rel","nofollow noopener noreferrer external"),p(T,"target","_blank"),p(X,"href","#又回到最初的起点"),p(K,"id","又回到最初的起点"),p(N,"href","#app-开发"),p(Q,"id","app-开发")},m(r,s){E(r,f,s),e(f,C),e(f,P),e(P,H),E(r,u,s),E(r,v,s),e(v,L),e(L,Ze),E(r,ye,s),E(r,x,s),e(x,Re),e(x,re),e(re,Ve),e(x,We),e(x,$),e($,Xe),e(x,Ge),E(r,$e,s),E(r,S,s),e(S,V),e(V,Ne),E(r,qe,s),E(r,W,s),e(W,ae),e(ae,Ye),E(r,Te,s),E(r,n,s),e(n,k),e(k,ge),e(k,q),e(q,et),e(k,tt),e(k,de),e(de,lt),e(k,ot),e(n,rt),e(n,j),e(j,at),e(j,ce),e(ce,dt),e(j,ct),e(n,st),e(n,z),e(z,ft),e(z,T),e(T,it),e(z,_t),e(n,nt),e(n,se),e(se,ut),e(n,Et),e(n,F),e(F,pt),e(F,fe),e(fe,ht),e(F,vt),e(n,Pt),e(n,J),e(J,mt),e(J,ie),e(ie,At),e(J,Ct),e(n,xt),e(n,A),e(A,Ot),e(A,_e),e(_e,Dt),e(A,Lt),e(A,ne),e(ne,kt),e(A,bt),e(A,ue),e(ue,It),e(A,wt),e(n,yt),e(n,Ee),e(Ee,$t),e(n,qt),e(n,b),e(b,Tt),e(b,pe),e(pe,Ut),e(b,Bt),e(b,he),e(he,Ht),e(b,St),E(r,Ue,s),E(r,K,s),e(K,X),e(X,jt),E(r,Be,s),E(r,U,s),e(U,ve),e(ve,zt),e(U,Ft),e(U,M),e(M,Jt),e(M,Pe),e(Pe,Kt),e(M,Mt),E(r,He,s),E(r,G,s),e(G,I),e(I,Qt),e(I,me),e(me,Zt),e(I,Rt),e(I,Ae),e(Ae,Vt),e(I,Wt),E(r,Se,s),E(r,Q,s),e(Q,N),e(N,Xt),E(r,je,s),E(r,m,s),e(m,Ce),e(Ce,Gt),e(m,Nt),e(m,O),e(O,Yt),e(O,xe),e(xe,gt),e(O,el),e(O,Oe),e(Oe,tl),e(O,ll),e(O,De),e(De,ol),e(m,rl),e(m,w),e(w,al),e(w,Le),e(Le,dl),e(w,cl),e(w,ke),e(ke,sl),e(w,fl),e(m,il),e(m,y),e(y,_l),e(y,be),e(be,nl),e(y,ul),e(y,Ie),e(Ie,El),e(y,pl),e(m,hl),e(m,we),e(we,vl)},p:mo,d(r){r&&t(f),r&&t(u),r&&t(v),r&&t(ye),r&&t(x),r&&t($e),r&&t(S),r&&t(qe),r&&t(W),r&&t(Te),r&&t(n),r&&t(Ue),r&&t(K),r&&t(Be),r&&t(U),r&&t(He),r&&t(G),r&&t(Se),r&&t(Q),r&&t(je),r&&t(m)}}}function xo(R){let f,C;const P=[R[0],so];let H={$$slots:{default:[Co]},$$scope:{ctx:R}};for(let u=0;u<P.length;u+=1)H=Pl(H,P[u]);return f=new Ao({props:H}),{c(){no(f.$$.fragment)},l(u){uo(f.$$.fragment,u)},m(u,v){Eo(f,u,v),C=!0},p(u,[v]){const L=v&1?po(P,[v&1&&ao(u[0]),v&0&&ao(so)]):{};v&2&&(L.$$scope={dirty:v,ctx:u}),f.$set(L)},i(u){C||(ho(f.$$.fragment,u),C=!0)},o(u){vo(f.$$.fragment,u),C=!1},d(u){Po(f,u)}}}const so={title:"小天同学 第三方 APP 开发",image:"/20230510/logo.svg",alt:"Az",created:"2023-05-10T00:00:00.000Z",updated:"2023-05-15T00:00:00.000Z",tags:["Android","Rev"],images:[],slug:"/20230510/+page.svelte.md",path:"/20230510",toc:[{depth:2,title:"APP 逆向",slug:"app-逆向"},{depth:2,title:"微信小程序 逆向",slug:"微信小程序-逆向"},{depth:2,title:"又回到最初的起点🎵",slug:"又回到最初的起点"},{depth:2,title:"APP 开发",slug:"app-开发"}]};function Oo(R,f,C){return R.$$set=P=>{C(0,f=Pl(Pl({},f),co(P)))},f=co(f),[f]}class ko extends fo{constructor(f){super(),io(this,f,Oo,xo,_o,{})}}export{ko as component};
